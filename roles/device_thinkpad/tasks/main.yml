- name: Install power management tools
  become: true
  apt:
    name:
      - tlp
      - tlp-rdw
    state: present
  when: is_thinkpad | bool
- name: Install firmware tools
  become: true
  apt:
    name:
      - fwupd
    state: present
  when: is_thinkpad | bool
- name: Ensure xinput is installed (required for touchscreen control)
  become: true
  apt:
    name: xinput
    state: present
  when: is_thinkpad | bool
  when:
    - ansible_facts['os_family'] == 'Debian'
    - is_thinkpad | bool
- name: Disable touchscreen on ThinkPad
  become: false
  shell: |
    id=$(xinput list --id-only 'Touchscreen' || true)
    if [ -n "$id" ]; then
      xinput disable "$id"
    fi
  when: 
    - thinkpad_disable_touchscreen | default(false)
    - is_thinkpad | bool
- name: Enable touchscreen on ThinkPad
  become: false
  shell: |
    id=$(xinput list --id-only 'Touchscreen' || true)
    if [ -n "$id" ]; then
      xinput enable "$id"
    fi
  when:
    - not (thinkpad_disable_touchscreen | default(false))
    - is_thinkpad | bool
