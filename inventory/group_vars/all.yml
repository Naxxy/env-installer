# inventory/group_vars/all.yml

# All features known to the system.
# These are the only install_* keys that will be derived and asserted.
env_known_features:
  - install_mpv
  - install_brave
  - install_netbird
  - install_jq
  - install_yt_dlp
  - install_magic_wormhole
  - install_lazyvim
  - install_caps_escape_swap

# Profile catalog (primary user interface): profile -> list of features enabled.
env_profiles_catalog:
  base:
    - install_brave

  keyboard:
    - install_caps_escape_swap

  media:
    - install_mpv

  vpn:
    - install_netbird

  dev_cli:
    - install_jq
    - install_yt_dlp
    - install_magic_wormhole
    - install_lazyvim

# Support matrix: feature -> pkg_family -> allowed flavors
# Use explicit 'all' to mean "supported for any flavor of this family".
env_feature_support:
  install_mpv:
    arch: { flavors: ["all"] }
    debian: { flavors: ["all"] }
    macos: { flavors: ["all"] }

  install_brave:
    arch: { flavors: ["all"] }
    debian: { flavors: ["all"] }
    macos: { flavors: ["all"] }

  install_netbird:
    arch: { flavors: ["arch", "omarchy"] }
    debian: { flavors: ["debian", "ubuntu", "kubuntu"] }
    macos: { flavors: ["macos"] }

  install_jq:
    arch: { flavors: ["all"] }
    debian: { flavors: ["all"] }
    macos: { flavors: ["all"] }

  install_yt_dlp:
    arch: { flavors: ["all"] }
    debian: { flavors: ["all"] }
    macos: { flavors: ["all"] }

  install_magic_wormhole:
    arch: { flavors: ["all"] }
    debian: { flavors: ["all"] }
    macos: { flavors: ["all"] }

  install_lazyvim:
    arch: { flavors: ["all"] }
    debian: { flavors: ["all"] }
    macos: { flavors: ["all"] }

  install_caps_escape_swap:
    debian: { flavors: ["kubuntu"] }

# Central mapping to make package-name differences obvious and auditable.
# Features should refer to these rather than embedding OS logic everywhere.
env_package_names:
  mpv:
    all: "mpv"

  brave:
    arch: "brave-bin"           # typical AUR choice
    debian: "brave-browser"     # placeholder until repo setup exists
    macos: "brave-browser"      # brew cask name

  jq:
    all: "jq"

  yt_dlp:
    arch: "yt-dlp"
    debian: "yt-dlp"
    macos: "yt-dlp"

  magic_wormhole:
    arch: "magic-wormhole"
    debian: "magic-wormhole"
    macos: "magic-wormhole"

  # LazyVim is NOT a package; we install Neovim + deps via packages, then clone.
  lazyvim_deps:
    arch:
      - "neovim"
      - "git"
      - "ripgrep"
      - "fd"
    debian:
      - "neovim"
      - "git"
      - "ripgrep"
      - "fd-find"
    macos:
      - "neovim"
      - "git"
      - "ripgrep"
      - "fd"

# -----------------------------
# Omarchy safety / snapshot preflight
# -----------------------------
# Omarchy provides bootable system snapshots via:
#   omarchy-snapshot create
# This is only available on installs using the Limine bootloader (Omarchy 2.0+ default).
#
# We treat "take a snapshot before installs" as a default safety requirement for Omarchy hosts.
# You may disable per-host via host_vars or extra-vars if you deliberately want to skip it.
env_omarchy_snapshot_before_install: true

# If true, fail fast if we detect an Omarchy host but cannot run omarchy-snapshot.
# (Example causes: missing omarchy-snapshot command, non-Limine bootloader, etc.)
env_omarchy_snapshot_required: true
